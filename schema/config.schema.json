{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/echohello-dev/yap-on-slack/main/schema/config.schema.json",
    "title": "Yap on Slack Configuration",
    "description": "Unified configuration for yap-on-slack tool",
    "type": "object",
    "required": [
        "workspace"
    ],
    "properties": {
        "workspace": {
            "type": "object",
            "description": "Slack workspace settings (required)",
            "required": [
                "org_url",
                "channel_id",
                "team_id"
            ],
            "properties": {
                "org_url": {
                    "type": "string",
                    "description": "Slack workspace URL (e.g., https://your-workspace.slack.com)",
                    "pattern": "^https://.+\\.slack\\.com$",
                    "examples": [
                        "https://your-workspace.slack.com"
                    ]
                },
                "channel_id": {
                    "type": "string",
                    "description": "Target channel ID (e.g., C0123456789)",
                    "pattern": "^C[A-Z0-9]{10,}$",
                    "examples": [
                        "C0123456789"
                    ]
                },
                "team_id": {
                    "type": "string",
                    "description": "Workspace team ID (e.g., T0123456789)",
                    "pattern": "^T[A-Z0-9]{10,}$",
                    "examples": [
                        "T0123456789"
                    ]
                }
            },
            "additionalProperties": false
        },
        "credentials": {
            "type": "object",
            "description": "Default Slack session credentials (used when no per-user tokens defined)",
            "properties": {
                "xoxc_token": {
                    "type": "string",
                    "description": "Slack xoxc session token (extract from browser dev tools)",
                    "pattern": "^xoxc-.+",
                    "examples": [
                        "xoxc-your-token-here"
                    ]
                },
                "xoxd_token": {
                    "type": "string",
                    "description": "Slack xoxd session token (extract from browser dev tools)",
                    "examples": [
                        "xoxd-your-token-here"
                    ]
                },
                "cookies": {
                    "type": "string",
                    "description": "Optional extra Slack cookies (semi-colon separated)",
                    "examples": [
                        "d-s=1234567890; x=xoxd-1234567890"
                    ]
                },
                "bot_token": {
                    "type": "string",
                    "description": "Slack bot token (alternative to session tokens). Use xoxb- token from Slack app OAuth settings. Bot must have chat:write, reactions:write, and channels:read scopes.",
                    "pattern": "^xoxb-.+",
                    "examples": [
                        "xoxb-your-bot-token-here"
                    ]
                }
            },
            "additionalProperties": false
        },
        "ssl": {
            "type": "object",
            "description": "SSL/TLS certificate verification settings (optional)",
            "properties": {
                "verify": {
                    "type": "boolean",
                    "description": "Enable SSL certificate verification (default: true, set to false for self-signed certs - insecure)",
                    "default": true
                },
                "ca_bundle": {
                    "type": "string",
                    "description": "Path to custom CA bundle file for SSL verification (e.g., ~/your-corporate-cert.pem for corporate proxies)",
                    "examples": [
                        "~/your-corporate-cert.pem",
                        "/etc/ssl/certs/ca-certificates.crt"
                    ]
                },
                "no_strict": {
                    "type": "boolean",
                    "description": "Disable strict X509 verification (Python 3.13+ compatibility for corporate proxy certificates)",
                    "default": false
                },
                "strict_x509": {
                    "type": ["boolean", "null"],
                    "description": "Force strict X509 verification mode (null=auto-disable for custom CA bundles, true=force enable, false=force disable)",
                    "default": null
                }
            },
            "additionalProperties": false
        },
        "user_strategy": {
            "type": "string",
            "description": "User selection strategy for multi-user posting",
            "enum": [
                "round_robin",
                "random"
            ],
            "default": "round_robin"
        },
        "users": {
            "type": "array",
            "description": "Additional users for multi-user posting (optional, merged with default credentials user)",
            "items": {
                "type": "object",
                "required": [
                    "name"
                ],
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "User identifier (used for assigning messages)",
                        "examples": [
                            "alice",
                            "bob",
                            "charlie"
                        ]
                    },
                    "xoxc_token": {
                        "type": "string",
                        "description": "Slack xoxc session token for this user",
                        "pattern": "^xoxc-.+",
                        "examples": [
                            "xoxc-alice-token"
                        ]
                    },
                    "xoxd_token": {
                        "type": "string",
                        "description": "Slack xoxd session token for this user",
                        "examples": [
                            "xoxd-alice-token"
                        ]
                    },
                    "cookies": {
                        "type": "string",
                        "description": "Optional extra Slack cookies for this user",
                        "examples": [
                            "d-s=1234567890"
                        ]
                    },
                    "bot_token": {
                        "type": "string",
                        "description": "Slack bot token for this user (alternative to session tokens)",
                        "pattern": "^xoxb-.+",
                        "examples": [
                            "xoxb-alice-bot-token"
                        ]
                    }
                },
                "additionalProperties": false
            }
        },
        "messages": {
            "type": "array",
            "description": "Messages to post (optional, can also use --use-ai to generate)",
            "items": {
                "type": "object",
                "required": [
                    "text"
                ],
                "properties": {
                    "text": {
                        "type": "string",
                        "description": "Message text with Slack formatting (markdown-like syntax)",
                        "examples": [
                            "Good morning team! :wave:",
                            "**Important**: Deploy scheduled for 2pm PST"
                        ]
                    },
                    "user": {
                        "type": "string",
                        "description": "User name to post as (defaults to round_robin/random selection)",
                        "examples": [
                            "alice",
                            "bob"
                        ]
                    },
                    "replies": {
                        "type": "array",
                        "description": "Thread replies to this message",
                        "items": {
                            "oneOf": [
                                {
                                    "type": "string",
                                    "description": "Reply text (uses default user selection)"
                                },
                                {
                                    "type": "object",
                                    "required": [
                                        "text"
                                    ],
                                    "properties": {
                                        "text": {
                                            "type": "string",
                                            "description": "Reply text"
                                        },
                                        "user": {
                                            "type": "string",
                                            "description": "User name for this reply"
                                        }
                                    },
                                    "additionalProperties": false
                                }
                            ]
                        }
                    },
                    "reactions": {
                        "type": "array",
                        "description": "Emoji reactions to add (without colons)",
                        "items": {
                            "type": "string",
                            "pattern": "^[a-z0-9_+-]+$",
                            "examples": [
                                "wave",
                                "coffee",
                                "rocket",
                                "eyes"
                            ]
                        }
                    }
                },
                "additionalProperties": false
            }
        },
        "ai": {
            "type": "object",
            "description": "AI message generation settings",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "description": "Enable AI message generation",
                    "default": false
                },
                "model": {
                    "type": "string",
                    "description": "OpenRouter model to use for generation (openrouter/auto recommended). See top weekly models: https://openrouter.ai/models?order=top-weekly",
                    "default": "openrouter/auto",
                    "examples": [
                        "openrouter/auto",
                        "google/gemini-2.5-flash",
                        "deepseek/deepseek-v3.2",
                        "anthropic/claude-sonnet-4.5",
                        "google/gemini-3-flash-preview",
                        "x-ai/grok-code-fast-1"
                    ]
                },
                "api_key": {
                    "type": "string",
                    "description": "OpenRouter API key (can also use OPENROUTER_API_KEY env var)",
                    "pattern": "^sk-or-v1-.+",
                    "examples": [
                        "sk-or-v1-your-key-here"
                    ]
                },
                "temperature": {
                    "type": "number",
                    "description": "Model temperature for generation (0.0-1.0)",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "default": 0.7
                },
                "max_tokens": {
                    "type": "integer",
                    "description": "Maximum tokens for generated response",
                    "minimum": 100,
                    "maximum": 10000,
                    "default": 4000
                },
                "system_prompt": {
                    "type": "string",
                    "description": "Custom system prompt for AI generation (overrides default). Default prompt: https://github.com/echohello-dev/yap-on-slack/blob/main/yap_on_slack/prompts/generate_messages.txt",
                    "examples": [
                        "Generate realistic engineering team Slack messages about infrastructure issues..."
                    ]
                },
                "github": {
                    "$ref": "#/properties/github",
                    "description": "GitHub context settings for AI generation (alternative location to top-level github)"
                }
            },
            "additionalProperties": false
        },
        "scan": {
            "type": "object",
            "description": "Channel scanning and system prompt generation settings",
            "properties": {
                "limit": {
                    "type": "integer",
                    "description": "Maximum messages to fetch when scanning",
                    "minimum": 10,
                    "maximum": 5000,
                    "default": 200
                },
                "throttle": {
                    "type": "number",
                    "description": "Delay in seconds between API call batches",
                    "minimum": 0.1,
                    "maximum": 10.0,
                    "default": 0.5
                },
                "output_dir": {
                    "type": "string",
                    "description": "Directory for generated prompts and exports (default: ~/.config/yap-on-slack/scan/)",
                    "examples": [
                        "~/.config/yap-on-slack/scan",
                        "./prompts"
                    ]
                },
                "model": {
                    "type": "string",
                    "description": "OpenRouter model for system prompt generation",
                    "default": "openrouter/auto",
                    "examples": [
                        "openrouter/auto",
                        "anthropic/claude-sonnet-4",
                        "google/gemini-2.5-flash"
                    ]
                },
                "export_data": {
                    "type": "boolean",
                    "description": "Export messages, threads, and reactions to text file",
                    "default": true
                }
            },
            "additionalProperties": false
        },
        "github": {
            "type": "object",
            "description": "GitHub context integration for AI message generation (optional)",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "description": "Enable GitHub context when generating AI messages",
                    "default": true
                },
                "token": {
                    "type": "string",
                    "description": "GitHub personal access token (can also use GITHUB_TOKEN env var)",
                    "pattern": "^(ghp_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9_]{82})$",
                    "examples": [
                        "ghp_1234567890abcdefghijklmnopqrstuvwxyz",
                        "github_pat_11A..."
                    ]
                },
                "limit": {
                    "type": "integer",
                    "description": "Maximum number of repositories to fetch context from",
                    "minimum": 1,
                    "maximum": 50,
                    "default": 5
                },
                "include_commits": {
                    "type": "boolean",
                    "description": "Include recent commits in AI context",
                    "default": true
                },
                "include_prs": {
                    "type": "boolean",
                    "description": "Include recent pull requests in AI context",
                    "default": true
                },
                "include_issues": {
                    "type": "boolean",
                    "description": "Include recent issues in AI context",
                    "default": true
                },
                "items_per_repo": {
                    "type": "object",
                    "description": "Per-category item limits when fetching from each repository",
                    "properties": {
                        "commits": {
                            "type": "integer",
                            "description": "Maximum commits to fetch per repository",
                            "minimum": 1,
                            "maximum": 100,
                            "default": 5
                        },
                        "prs": {
                            "type": "integer",
                            "description": "Maximum pull requests to fetch per repository",
                            "minimum": 1,
                            "maximum": 100,
                            "default": 5
                        },
                        "issues": {
                            "type": "integer",
                            "description": "Maximum issues to fetch per repository",
                            "minimum": 1,
                            "maximum": 100,
                            "default": 5
                        }
                    },
                    "additionalProperties": false
                },
                "repos": {
                    "type": "object",
                    "description": "Repository selection configuration",
                    "properties": {
                        "mode": {
                            "type": "string",
                            "description": "Repository selection mode: auto (recently updated), include (specific repos), exclude (blacklist)",
                            "enum": [
                                "auto",
                                "include",
                                "exclude"
                            ],
                            "default": "auto"
                        },
                        "include": {
                            "type": "array",
                            "description": "Specific repositories to fetch (when mode=include). Format: owner/repo",
                            "items": {
                                "type": "string",
                                "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
                                "examples": [
                                    "echohello-dev/yap-on-slack",
                                    "myorg/project"
                                ]
                            }
                        },
                        "exclude": {
                            "type": "array",
                            "description": "Repositories to exclude (when mode=exclude). Format: owner/repo",
                            "items": {
                                "type": "string",
                                "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
                                "examples": [
                                    "myorg/archived-repo",
                                    "myorg/test-repo"
                                ]
                            }
                        }
                    },
                    "additionalProperties": false
                },
                "date_since": {
                    "type": "string",
                    "description": "Filter data since this date. Use ISO date (YYYY-MM-DD) or relative format (7d, 30d, 2w, 24h)",
                    "examples": [
                        "7d",
                        "30d",
                        "2024-01-01",
                        "2024-12-01T00:00:00Z"
                    ],
                    "pattern": "^(\\d{4}-\\d{2}-\\d{2}(T\\d{2}:\\d{2}:\\d{2}(.\\d+)?Z?)?|\\d+[dhwm])$"
                },
                "authors": {
                    "type": "array",
                    "description": "Filter by GitHub usernames. Use '@me' for authenticated user",
                    "items": {
                        "type": "string",
                        "examples": [
                            "@me",
                            "octocat",
                            "dependabot[bot]"
                        ]
                    }
                },
                "pr_state": {
                    "type": "string",
                    "description": "Filter pull requests by state",
                    "enum": [
                        "open",
                        "closed",
                        "all"
                    ],
                    "default": "all"
                },
                "issue_state": {
                    "type": "string",
                    "description": "Filter issues by state",
                    "enum": [
                        "open",
                        "closed",
                        "all"
                    ],
                    "default": "all"
                },
                "include_repo_metadata": {
                    "type": "boolean",
                    "description": "Include repository metadata (language, topics, stars, description) in AI context",
                    "default": true
                }
            },
            "additionalProperties": false
        }
    },
    "additionalProperties": false
}